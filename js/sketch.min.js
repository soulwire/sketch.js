/**
 * Copyright (C) 2012 by Justin Windle
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Sketch=function(){function d(r){r=v(r||{},f);var s="sketch-"+e++;var o=document.createElement("canvas");switch(r.type){case n:try{i=o.getContext("webgl",r)}catch(u){}try{i=i||o.getContext("experimental-webgl",r)}catch(u){}if(!i)throw"WebGL not supported";break;case t:try{i=o.getContext("2d",r)}catch(u){}if(!i)throw"Canvas not supported";break;default:o=i=document.createElement("div")}i.canvas=o;o.className="sketch";o.id=s;r.container.appendChild(o);v(self,l);v(i,r);v(i,c);g();b();a.push(i);if(i.autostart)setTimeout(i.start,0);return i}function v(e,t){for(var n in t){if(!e.hasOwnProperty(n)){e[n]=t[n]}}return e}function m(e){function n(e,t){return function(){e.call(t,arguments)}}var t={};for(var r in e){if(typeof e[r]==="function")t[r]=n(e[r],e);else t[r]=e[r]}return t}function g(){function n(t){return e[t]||String.fromCharCode(t)}function r(e){i.mouse.ox=i.mouse.x;i.mouse.oy=i.mouse.y;i.mouse.x=e.x;i.mouse.y=e.y;i.mouse.dx=i.mouse.x-i.mouse.ox;i.mouse.dy=i.mouse.y-i.mouse.oy}function o(e){var t,n=m(e);n.original=e;for(var r=i.canvas,o=0,u=0;r;r=r.offsetParent){o+=r.offsetLeft;u+=r.offsetTop}if(n.touches&&!!n.touches.length){for(var a=n.touches.length-1,f;a>=0;a--){f=n.touches[a];f.x=f.pageX-o;f.y=f.pageY-u;t=s[a]||f;f.dx=f.x-t.x;f.dy=f.y-t.x;f.ox=t.x;f.oy=t.y;s[a]=m(f)}}else{n.x=n.pageX-o;n.y=n.pageY-u;t=s["mouse"]||n;n.dx=n.x-t.x;n.dy=n.y-t.y;n.ox=t.x;n.oy=t.y;s["mouse"]=n}return n}function u(e){e.preventDefault();e=o(e);i.touches=e.touches;r(i.touches[0]);if(i.touchstart)i.touchstart(e);if(i.mousedown)i.mousedown(e)}function a(e){e=o(e);i.touches=e.touches;r(i.touches[0]);if(i.touchmove)i.touchmove(e);if(i.mousemove)i.mousemove(e)}function f(e){e=o(e);if(!e.touches.length)s={};else for(var t in s)if(!e.touches[t])delete s[t];if(i.touchend)i.touchend(e);if(i.mouseup)i.mouseup(e)}function l(e){e=o(e);if(i.mouseover)i.mouseover(e)}function d(e){e=o(e);if(!i.dragging){p(i.canvas,"mousemove",v);p(i.canvas,"mouseup",y);h(document,"mousemove",v);h(document,"mouseup",y);i.dragging=true}i.touches=[e];if(i.touchstart)i.touchstart(e);if(i.mousedown)i.mousedown(e)}function v(e){e=o(e);r(e);i.touches=[e];if(i.touchmove)i.touchmove(e);if(i.mousemove)i.mousemove(e)}function g(e){e=o(e);if(i.mouseout)i.mouseout(e)}function y(e){e=o(e);if(i.dragging){p(document,"mousemove",v);p(document,"mouseup",y);h(i.canvas,"mousemove",v);h(i.canvas,"mouseup",y);i.dragging=false}delete s["mouse"];if(i.touchend)i.touchend(e);if(i.mouseup)i.mouseup(e)}function w(e){e=o(e);if(i.click)i.click(e)}function E(e){i.keys[n(e.keyCode)]=true;i.keys[e.keyCode]=true;if(i.keydown)i.keydown(e)}function S(e){i.keys[n(e.keyCode)]=false;i.keys[e.keyCode]=false;if(i.keyup)i.keyup(e)}var e={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};for(var t in e){c.keys[e[t]]=false}var s={};h(i.canvas,"touchstart",u);h(i.canvas,"touchmove",a);h(i.canvas,"touchend",f);h(i.canvas,"mouseover",l);h(i.canvas,"mousedown",d);h(i.canvas,"mousemove",v);h(i.canvas,"mouseout",g);h(i.canvas,"mouseup",y);h(i.canvas,"click",w);h(document,"keydown",E);h(document,"keyup",S);h(window,"resize",b)}function y(e){if(!s){i.dt=(e=e||Date.now())-i.now;i.millis+=i.dt;i.now=e;if(i.update)i.update(i.dt);if(i.autoclear)i.clear();if(i.draw)i.draw(i)}s=++s%i.interval;o=requestAnimationFrame(y)}function b(e){var n=i.type===r?i.style:i.canvas;if(i.fullscreen){i.height=n.height=window.innerHeight;i.width=n.width=window.innerWidth}else{n.height=i.height;n.width=i.width}if(i.retina&&i.type===t&&window.devicePixelRatio){var s=n.height;var o=n.width;i.canvas.height=s*window.devicePixelRatio;i.canvas.width=o*window.devicePixelRatio;i.scale(window.devicePixelRatio,window.devicePixelRatio);i.canvas.style.cssText="height: "+s+"px; width: "+o+"px;"}if(i.resize)i.resize()}var e=0;var t="canvas";var n="web-gl";var r="dom";var i;var s=0;var o=-1;var u={};var a=[];var f={fullscreen:true,autostart:true,autoclear:true,autopause:true,container:document.body,interval:1,type:t,retina:false};var l={PI:Math.PI,TWO_PI:Math.PI*2,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,atan:Math.atan,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,random:function(e,t){if(e&&typeof e.length==="number"&&!!e.length)return e[Math.floor(Math.random()*e.length)];if(typeof t!=="number")t=e||1,e=0;return e+Math.random()*(t-e)}};var c={millis:0,now:NaN,dt:NaN,keys:{},mouse:{x:0,y:0,ox:0,oy:0,dx:0,dy:0},touches:[],initialized:false,dragging:false,running:false,start:function(){if(i.running)return;if(i.setup&&!i.initialized){if(i.autopause){h(window,"focus",i.start);h(window,"blur",i.stop)}i.setup()}i.initialized=true;i.running=true;i.now=Date.now();y()},stop:function(){cancelAnimationFrame(o);i.running=false},toggle:function(){(i.running?i.stop:i.start)()},clear:function(){if(i.canvas){i.canvas.width=i.canvas.width;if(i.retina&&window.devicePixelRatio){i.scale(window.devicePixelRatio,window.devicePixelRatio)}}},destroy:function(){var e,t,n,r,s,o;a.splice(a.indexOf(i),1);i.stop();for(t in u){n=u[t];for(s=0,o=n.length;s<o;s++){e=n[s];p(e.el,t,e.fn)}delete u[t]}i.container.removeChild(i.canvas);for(r in i){if(i.hasOwnProperty(r)){delete i[r]}}}};var h=function(){function e(e,t,n){if(!u[t])u[t]=[];u[t].push({el:e,fn:n})}if(window.addEventListener){return function(t,n,r){t.addEventListener(n,r,false);e(t,n,r)}}else if(window.attachEvent){return function(t,n,r){t.attachEvent("on"+n,r);e(t,n,r)}}else{return function(t,n,r){t["on"+n]=r;e(t,n,r)}}}();var p=function(){function e(e,t,n){if(u[t]){var r;for(var i=u[t].length-1;i>=0;i--){r=u[t][i];if(r.el===e&&r.fn===n){u[t].splice(i,1)}}}}if(window.removeEventListener){return function(t,n,r){t.removeEventListener(n,r,false);e(t,n,r)}}else if(window.detachEvent){return function(t,n,r){t.detachEvent("on"+n,r);e(t,n,r)}}else{el["on"+ev]=null;e(el,ev,fn)}}();return{CANVAS:t,WEB_GL:n,DOM:r,instances:a,create:d}}();if(!Date.now){Date.now=function(){return+(new Date)}}(function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);e=n+r;return i});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})()
