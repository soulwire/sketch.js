/* Copyright (C) 2013 Justin Windle, http://soulwire.co.uk */
!function(e,t){"object"==typeof exports?module.exports=t(e,e.document):"function"==typeof define&&define.amd?define(function(){return t(e,e.document)}):e.Sketch=t(e,e.document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(e){return"[object Array]"==Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}function r(e){return"number"==typeof e}function i(e){return"string"==typeof e}function u(e){return C[e]||String.fromCharCode(e)}function a(e,t,n){for(var o in t)!n&&o in e||(e[o]=t[o]);return e}function c(e,t){return function(){e.apply(t,arguments)}}function l(e){var t={};for(var n in e)"webkitMovementX"!==n&&"webkitMovementY"!==n&&(o(e[n])?t[n]=c(e[n],e):t[n]=e[n]);return t}function s(t){function n(e){o(e)&&e.apply(t,[].splice.call(arguments,1))}function r(e){for(G=0;G<oe.length;G++)D=oe[G],i(D)?_[(e?"add":"remove")+"EventListener"].call(_,D,N,!1):o(D)?N=D:_=D}function c(r){L(R),R=I(c),J||(n(t.resize),J=o(t.resize)),Z||E(),t.running&&!K&&(t.dt=U?e.performance.now()-U:0,t.millis+=t.dt,U=r,t.now=r,n(t.update),te&&(t.retina&&(t.save(),t.autoclear&&t.scale($,$)),t.autoclear&&t.clear()),n(t.draw),te&&t.retina&&t.restore()),K=++K%t.interval}function s(){_=ee?t.style:t.canvas,W=ee?"px":"",q=t.width,Q=t.height,t.fullscreen&&(Q=t.height=w.innerHeight,q=t.width=w.innerWidth),t.retina&&te&&$&&(_.style.height=Q+"px",_.style.width=q+"px",q*=$,Q*=$),_.height!==Q&&(_.height=Q+W),_.width!==q&&(_.width=q+W),te&&!t.autoclear&&t.retina&&t.scale($,$),Z&&n(t.resize)}function f(e,t){return B=t.getBoundingClientRect(),e.x=e.pageX-B.left-(w.scrollX||w.pageXOffset),e.y=e.pageY-B.top-(w.scrollY||w.pageYOffset),e}function d(e,n){return f(e,t.element),n=n||{},n.ox=n.x||e.x,n.oy=n.y||e.y,n.x=e.x,n.y=e.y,n.dx=n.x-n.ox,n.dy=n.y-n.oy,n}function p(e){if(e.preventDefault(),F=l(e),F.originalEvent=e,F.touches)for(V.length=F.touches.length,G=0;G<F.touches.length;G++)V[G]=d(F.touches[G],V[G]);else V.length=0,V[0]=d(F,ne);return a(ne,V[0],!0),F}function g(e){for(e=p(e),Y=(j=oe.indexOf(H=e.type))-1,t.dragging=!!/down|start/.test(H)||!/up|end/.test(H)&&t.dragging;Y;)i(oe[Y])?n(t[oe[Y--]],e):i(oe[j])?n(t[oe[j++]],e):Y=0}function m(e){M=e.keyCode,X="keyup"==e.type,re[M]=re[u(M)]=!X,n(t[e.type],e)}function y(e){t.autopause&&("blur"==e.type?T:P)(),n(t[e.type],e)}function E(){n(t.setup),Z=o(t.setup)}function k(){t.st=e.performance.now(),r(!0),E(),s(),t.autostart&&P()}function P(){t.running||(t.running=!0,R=I(c))}function T(){t.running&&(L(R),U=0,t.dt=-1,t.now=-1,t.running=!1)}function A(){(t.running?T:P)()}function S(){te&&t.clearRect(0,0,t.width*$,t.height*$)}function O(){z=t.element.parentNode,G=b.indexOf(t),z&&z.removeChild(t.element),~G&&b.splice(G,1),r(!1),T()}var R,N,_,z,B,G,W,D,F,H,M,X,Y,j,q,Q,U=0,K=0,V=[],J=!1,Z=!1,$=w.devicePixelRatio||1,ee=t.type==x,te=t.type==h,ne={x:0,y:0,ox:0,oy:0,dx:0,dy:0},oe=[t.eventTarget||t.element,g,"mousedown","touchstart",g,"mousemove","touchmove",g,"mouseup","touchend",g,"click",g,"mouseout",g,"mouseover",v,m,"keydown","keyup",w,y,"focus","blur",s,"resize"],re={};for(M in C)re[C[M]]=!1;return a(t,{touches:V,mouse:ne,keys:re,dragging:!1,running:!1,millis:0,now:-1,dt:-1,destroy:O,toggle:A,clear:S,start:P,stop:T}),b.push(t),k(),t}for(var f,d,p="E LN10 LN2 LOG2E LOG10E PI SQRT1_2 SQRT2 abs acos asin atan ceil cos exp floor log round sin sqrt tan atan2 pow max min".split(" "),g="__hasSketch",m=Math,h="canvas",y="webgl",x="dom",v=t,w=e,b=[],E={fullscreen:!0,autostart:!0,autoclear:!0,autopause:!0,container:v.body,interval:1,globals:!0,retina:!1,type:h},C={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},k={CANVAS:h,WEB_GL:y,WEBGL:y,DOM:x,instances:b,install:function(e){if(!e[g]){for(var t=0;t<p.length;t++)e[p[t]]=m[p[t]];a(e,{TWO_PI:2*m.PI,HALF_PI:m.PI/2,QUARTER_PI:m.PI/4,random:function(e,t){return n(e)?e[~~(m.random()*e.length)]:(r(t)||(t=e||1,e=0),e+m.random()*(t-e))},lerp:function(e,t,n){return e+n*(t-e)},map:function(e,t,n,o,r){return(e-t)/(n-t)*(r-o)+o}}),e[g]=!0}},create:function(e){return e=a(e||{},E),e.globals&&k.install(self),f=e.element=e.element||v.createElement(e.type===x?"div":"canvas"),d=e.context=e.context||function(){switch(e.type){case h:return f.getContext("2d",e);case y:return f.getContext("webgl",e)||f.getContext("experimental-webgl",e);case x:return f.canvas=f}}(),(e.container||v.body).appendChild(f),k.augment(d,e)},augment:function(e,t){return t=a(t||{},E),t.element=e.canvas||e,t.element.className+=" sketch",a(e,t,!0),s(e)}},P=["ms","moz","webkit","o"],T=self,A=0,S="AnimationFrame",O="request"+S,R="cancel"+S,I=T[O],L=T[R],N=0;N<P.length&&!I;N++)I=T[P[N]+"Request"+S],L=T[P[N]+"Cancel"+S];return T[O]=I=I||function(e){var t=+new Date,n=m.max(0,16-(t-A)),o=setTimeout(function(){e(t+n)},n);return A=t+n,o},T[R]=L=L||function(e){clearTimeout(e)},k});